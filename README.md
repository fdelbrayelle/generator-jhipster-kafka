# generator-jhipster-kafka

[![NPM version][npm-image]][npm-url] [![Build Status][github-actions-image]][github-actions-url] [![Dependency Status][daviddm-image]][daviddm-url]

> JHipster module, A JHipster module to generate Apache Kafka consumers and producers.

# Introduction

This is a [JHipster](https://www.jhipster.tech/) module, that is meant to be used in a JHipster application.

# Prerequisites

As this is a [JHipster](https://www.jhipster.tech/) module, we expect you have JHipster and its related tools already installed:

- [Installing JHipster](https://www.jhipster.tech/installation/)

# Installation

## With NPM

To install this module:

```bash
npm install -g generator-jhipster-kafka
```

To update this module:

```bash
npm update -g generator-jhipster-kafka
```

## With Yarn

To install this module:

```bash
yarn global add generator-jhipster-kafka
```

To update this module:

```bash
yarn global upgrade generator-jhipster-kafka
```

# Usage

This describes how to use basically this module with a JHipster generated project:

1. Create a JHipster project in a new folder: `mkdir myproject && jhipster`
2. Choose `Asynchronous messages using Apache Kafka` in server side options when answering the following question : "Which other technologies would you like to use?"
3. Go to the `generator-jhipster-kafka` project folder and run `npm link`
4. Go back to your JHipster project and run `npm link generator-jhipster-kafka`
5. In the same folder, then run `yo jhipster-kafka`
6. You can choose to add a consumer and/or a producer for an given entity name (identified by its domain class name in the package `domain` of your JHipster application, where entities are generated by `jhipster entity` or JDL Studio based file through `jhipster import-jdl file_name.jh`)

## Skip prompts

You can use `yo jhipster-kafka --skip-prompts` to use the default prompts values to generate:

- a minimal `kafka` configuration in `application.yml` files with only a `bootstrap.servers`
- a `akhq.yml` docker-compose file to run AKHQ (see below)
- a `GenericConsumer.java` that you extend to create your own consumers

## Test consumers and producers

You can use your producer (`*Producer.java`) in other layers like resources or services by instancing it and using its `send` method (which is asynchronous).

By default a `*KafkaResource.java` is also generated with the producer. It has an endpoint to call the generated producer. Supposing you have generated consumers and producers for an existing `Foo` JHIpster entity (with a String field `foo`) and for no entity (`Bar` prefix), you can test it that way with `curl` and `jq`:

```
token=`curl -X POST localhost:8080/api/authenticate -d '{ "username": "admin", "password": "admin" }' -H "Content-Type: application/json"|jq -r '.id_token'`

# For a producer linked to an entity (Foo as JSON):
curl -H "Authorization: Bearer $token" -H 'Content-Type: application/json' -d '{ "foo": "foo" }' -X POST localhost:8080/api/foos/kafka

# For a producer not linked to an entity (String):
curl -H "Authorization: Bearer $token" -H 'Content-Type: application/json' -d 'bar' -X POST localhost:8080/api/bars/kafka
```

Generated consumers should not be explicitly used in other classes as each of them is running in a thread listening to the incoming messages. However, messages sent through the generated producer will be read if an associated consumer has been generated as well. You just have to read the logs of `./mvnw` locally.

## AKHQ

ðŸš€ [AKHQ (previously known as KafkaHQ)](https://github.com/tchiotludo/akhq) can be used following those steps in the root directory:

1. Run `docker-compose -f src/main/docker/kafka.yml -f src/main/docker/akhq.yml up -d` to launch the ZooKeeper and Kafka services with AKHQ
1. Go to [http://localhost:11817](http://localhost:11817)
1. Start your application with `./mvnw` to manage your topics and more!

# License

Apache-2.0 Â© [FranÃ§ois Delbrayelle](https://fdelbrayelle.github.io/)

[npm-image]: https://img.shields.io/npm/v/generator-jhipster-kafka.svg
[npm-url]: https://npmjs.org/package/generator-jhipster-kafka
[github-actions-image]: https://github.com/fdelbrayelle/generator-jhipster-kafka/workflows/Build/badge.svg
[github-actions-url]: https://github.com/fdelbrayelle/generator-jhipster-kafka/actions
[daviddm-image]: https://david-dm.org/fdelbrayelle/generator-jhipster-kafka.svg?theme=shields.io
[daviddm-url]: https://david-dm.org/fdelbrayelle/generator-jhipster-kafka
